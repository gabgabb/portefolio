services:
    strapi:
        image: gabgabb/portefolio-strapi:latest
        restart: always
        ports:
            - '1337:1337'
        volumes:
            - ./strapi:/app
        environment:
            - NODE_ENV=${NODE_ENV}
            - DATABASE_CLIENT=sqlite
            - DATABASE_FILENAME=./data/data.db
        env_file:
            - .env

    nextjs:
        image: gabgabb/portefolio-nextjs:latest
        restart: always
        ports:
            - '3000:3000'
        volumes:
            - ./nextjs:/app
            - nextjs_cache:/app/.next  # Monte le volume `.next`
        environment:
            - NODE_ENV=${NODE_ENV}
        env_file:
            - .env
        user: "node"  # Assure que le conteneur tourne sous l'utilisateur node

volumes:
    nextjs_cache:
